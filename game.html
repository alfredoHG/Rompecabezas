<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Juego</title>
    <link rel="icon" href="" type="image/x-icon" />
    <link rel="shortcut icon" href="" type="image/x-icon" />

    <link rel="stylesheet" href="css/app.css" />

    <style>
        .container-iframe {
            position: relative;
            overflow: hidden;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio (divide 9 by 16 = 0.5625) */
        }

        /* Then style the iframe to fit in the container div with full height and width */
        .responsive-iframe {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<main id="app-3m">
    <section style="background: url('images/fondo-info_04.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-8 offset-lg-1 text-center">
                    <h2 class="font-weight-bold" style="text-transform: none">Rompecabezas</h2>
                    <div class="container-iframe">
                        <iframe id="inlineFrameExample" class="responsive-iframe"
                                title="Rompecabezas"
                                src="http://rompecabezas.com.lndo.site/rompecabezas.html">
                        </iframe>
                    </div>
                </div>
                <div class="col-12 col-lg-3">
                    <div class="mt-5 p-4 text-center" style="background-color: #FF0000; border-radius: 10px;">
                        <h5 class="font-weight-bold" style="text-transform: none">
                            ¡Te recomendamos empezar por los bordes!
                        </h5>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-12">
                    <div class="foot-info">© 3M 2021. Derechos Reservados.
                        <div class="right-foot">
                            <a href="https://3m-proyectos.s3.us-west-2.amazonaws.com/cisa/documentos/Aviso+de+Privacidad+3-CISA+Digital+Experience.pdf" target="_blank" style="margin-right:.5rem">Aviso de Privacidad</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
</main>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>
    let finJuegoDate = "";
    let inicioJuegoDate = "";

    $(document).ready(function() {
        $.ajax({
            url: "https://cisa2021-pruebas.virtualevents.mx/usuarios/fecha",
            method: 'get',
        })
            .done(function( data ) {
                inicioJuegoDate = data.fecha
            })
    })

    window.document.addEventListener('gameCompleted', handleEvent, false)
    function handleEvent(e) {
        $.ajax({
            url: "https://cisa2021-pruebas.virtualevents.mx/usuarios/fecha",
            method: 'get',
        })
            .done(function( data ) {
                finJuegoDate = data.fecha

                inicioJuegoDate = Date.parse(inicioJuegoDate);
                finJuegoDate = Date.parse(finJuegoDate);

                let puntaje = (~~((finJuegoDate - inicioJuegoDate)/1000)) % 60;
                $.ajax({
                    url: "https://cisa2021-pruebas.virtualevents.mx/usuarios/registrar-puntaje",
                    method: 'post',
                    data: {
                        juego: 'Rompecabezas',
                        puntaje: puntaje,
                        inicio_juego: inicioJuegoDate.toJSON().replace('T', ' ').substr(0, 19),
                        fin_juego: finJuegoDate.toJSON().replace('T', ' ').substr(0, 19),
                    }
                })
                    .done(function( data ) {
                        //
                    })
            })
    }
</script>
</body>
</html>